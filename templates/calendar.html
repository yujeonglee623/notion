<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YuJeong's Perfect Calendar</title>
    <style>
        /* 디자인은 그대로 유지! */
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, Roboto, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: transparent;
            color: #333;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 380px;
            background-color: rgba(255, 255, 255, 0.95); /* 가독성 위해 배경 조금 더 진하게 */
            padding: 15px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        .header {
            font-size: 1.1rem;
            font-weight: 800;
            margin-bottom: 15px;
            color: #333;
            padding-left: 5px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }

        .day-name {
            text-align: center;
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 5px;
        }

        .day {
            aspect-ratio: 1/1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border-radius: 10px;
            font-size: 0.85rem;
            transition: 0.2s;
            background-color: rgba(255,255,255,0.8);
            position: relative;
        }

        .day:hover { background-color: #f0f0f0; }

        .day.today {
            border: 2px solid #FFD9E8;
            color: #E16259;
            font-weight: bold;
        }

        .day.selected {
            background-color: #333 !important;
            color: white !important;
        }

        .day.has-event {
            background-color: #FFD9E8 !important;
            color: #d63384 !important;
            font-weight: bold;
        }

        .dot-container {
            display: flex;
            gap: 2px;
            margin-top: 2px;
        }
        .dot {
            width: 3px;
            height: 3px;
            background-color: #d63384;
            border-radius: 50%;
        }

        .input-group {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        input {
            flex: 1;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
            outline: none;
            font-size: 0.9rem;
        }
        
        input:focus { border-color: #FFD9E8; }

        button {
            padding: 0 15px;
            background: #333;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.8rem;
        }

        #todo-list {
            max-height: 200px;
            overflow-y: auto;
        }

        .todo-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: white;
            margin-bottom: 6px;
            border-radius: 8px;
            font-size: 0.85rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .date-badge {
            background: #FFD9E8;
            color: #d63384;
            padding: 3px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin-right: 8px;
            font-weight: 800;
        }

        .del-btn {
            margin-left: auto;
            cursor: pointer;
            color: #ccc;
            padding: 5px 10px; /* 클릭 잘 되게 영역 넓힘 */
            font-size: 1rem;
        }
        .del-btn:hover { color: #ff4d4d; }

    </style>
</head>
<body>

    <div class="container">
        <div class="header" id="month-year"></div>

        <div class="calendar-grid" id="calendar">
            <div class="day-name">일</div><div class="day-name">월</div><div class="day-name">화</div>
            <div class="day-name">수</div><div class="day-name">목</div><div class="day-name">금</div><div class="day-name">토</div>
        </div>

        <div class="input-group">
            <input type="text" id="todo-input" placeholder="날짜를 선택하세요!" disabled>
            <button id="save-btn">추가</button>
        </div>

        <div id="todo-list"></div>
    </div>

    <script>
        const calendarEl = document.getElementById('calendar');
        const monthYearEl = document.getElementById('month-year');
        const inputEl = document.getElementById('todo-input');
        const saveBtn = document.getElementById('save-btn');
        const todoListEl = document.getElementById('todo-list');

        const date = new Date();
        const currentYear = date.getFullYear();
        const currentMonth = date.getMonth();

        const STORAGE_KEY = 'yujeong_multi_v1';
        let events = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        let selectedDateKey = null;

        function render() {
            monthYearEl.innerText = `${currentYear}년 ${currentMonth + 1}월`;

            while (calendarEl.children.length > 7) {
                calendarEl.removeChild(calendarEl.lastChild);
            }

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const lastDate = new Date(currentYear, currentMonth + 1, 0).getDate();

            for(let i=0; i<firstDay; i++) calendarEl.appendChild(document.createElement('div'));

            for(let i=1; i<=lastDate; i++) {
                const day = document.createElement('div');
                day.className = 'day';
                
                const key = `${currentYear}-${String(currentMonth+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                
                const dateNum = document.createElement('span');
                dateNum.innerText = i;
                day.appendChild(dateNum);

                const today = new Date();
                if(i === today.getDate() && currentMonth === today.getMonth()) day.classList.add('today');

                if(events[key] && events[key].length > 0) {
                    day.classList.add('has-event');
                    const dotContainer = document.createElement('div');
                    dotContainer.className = 'dot-container';
                    const count = Math.min(events[key].length, 3);
                    for(let d=0; d<count; d++) {
                        const dot = document.createElement('div');
                        dot.className = 'dot';
                        dotContainer.appendChild(dot);
                    }
                    day.appendChild(dotContainer);
                }

                if(key === selectedDateKey) day.classList.add('selected');

                day.onclick = () => {
                    selectedDateKey = key;
                    inputEl.disabled = false;
                    inputEl.placeholder = `${i}일: 할 일을 추가하세요`;
                    inputEl.value = '';
                    inputEl.focus();
                    render();
                };

                calendarEl.appendChild(day);
            }

            renderList();
        }

        function renderList() {
            todoListEl.innerHTML = '';
            
            Object.keys(events).sort().forEach(key => {
                const tasks = events[key];
                
                if (tasks && tasks.length > 0) {
                    tasks.forEach((task, index) => {
                        // 요기! 안전한 방식으로 요소 만들기
                        const div = document.createElement('div');
                        div.className = 'todo-item';
                        
                        const d = new Date(key);
                        
                        const badge = document.createElement('span');
                        badge.className = 'date-badge';
                        badge.innerText = `${d.getMonth()+1}/${d.getDate()}`;
                        
                        const text = document.createElement('span');
                        text.style.flex = '1';
                        text.innerText = task;

                        // ★ 삭제 버튼 (안전한 방식)
                        const delBtn = document.createElement('span');
                        delBtn.className = 'del-btn';
                        delBtn.innerText = '✕';
                        
                        // 클릭 이벤트 직접 연결! (이러면 절대 안 막힘)
                        delBtn.addEventListener('click', () => {
                            if(confirm('이 할 일을 정말 지울까?')) {
                                events[key].splice(index, 1);
                                if(events[key].length === 0) delete events[key];
                                localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
                                render(); // 다시 그리기
                            }
                        });

                        div.appendChild(badge);
                        div.appendChild(text);
                        div.appendChild(delBtn);
                        
                        todoListEl.appendChild(div);
                    });
                }
            });
        }

        function save() {
            if(!selectedDateKey) return alert('날짜를 먼저 콕! 찍어주세요');
            const text = inputEl.value.trim();
            if(!text) return; 

            if(!events[selectedDateKey]) {
                events[selectedDateKey] = [];
            }
            events[selectedDateKey].push(text);

            localStorage.setItem(STORAGE_KEY, JSON.stringify(events));
            inputEl.value = '';
            render();
        }

        saveBtn.onclick = save;
        inputEl.onkeypress = (e) => { if(e.key === 'Enter') save(); };

        render();
    </script>
</body>
</html>
