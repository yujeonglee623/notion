<script>
        // â­ ìœ ì •ì´ í”Œë¦¬ ID (PL... ì „ì²´!)
        const MY_PLAYLISTS = [
            { name: "ğŸµ Liked", id: "PLRt0gIuMcszKrYLPxNQJUK3u0eHU6Ipla" }, 
        ];

        let currentPlaylistId = MY_PLAYLISTS[0].id;
        let player;
        let updateTimer;
        let isShuffle = false;
        let isReady = false; // ì¤€ë¹„ ìƒíƒœ ì²´í¬

        const dropdown = document.getElementById('playlist-dropdown');
        const playBtn = document.getElementById('play');
        const prevBtn = document.getElementById('prev');
        const nextBtn = document.getElementById('next');
        const shuffleBtn = document.getElementById('shuffle');
        const titleEl = document.getElementById('title');
        const artistEl = document.getElementById('artist');
        const coverEl = document.getElementById('cover');
        const coverContainer = document.getElementById('cover-container');
        const progress = document.getElementById('progress');
        const progressContainer = document.getElementById('progress-container');

        // ë“œë¡­ë‹¤ìš´ ì„¤ì •
        MY_PLAYLISTS.forEach((pl) => {
            const option = document.createElement('option');
            option.value = pl.id;
            option.text = pl.name;
            dropdown.appendChild(option);
        });

        dropdown.addEventListener('change', (e) => {
            currentPlaylistId = e.target.value;
            if(player && player.loadPlaylist) {
                player.loadPlaylist({ list: currentPlaylistId, listType: 'playlist' });
            }
        });

        // ìœ íŠœë¸Œ API ë¡œë“œ
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('yt-player', {
                height: '200', width: '200', // â­ í¬ê¸°ë¥¼ ì¢€ í‚¤ì›€ (ì•ˆ ë³´ì´ê²Œ ìˆ¨ê¸¸ ê±°ë‹ˆê¹Œ ê´œì°®ì•„)
                playerVars: {
                    'listType': 'playlist',
                    'list': currentPlaylistId,
                    'playsinline': 1,
                    'controls': 0,
                    'disablekb': 1,
                    'origin': window.location.origin
                },
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange,
                    'onError': onPlayerError
                }
            });
        }

        function onPlayerError(event) {
            console.log("Error:", event.data);
            // ì—ëŸ¬ ë‚˜ë©´ ë‹¤ìŒ ê³¡ìœ¼ë¡œ
            setTimeout(() => { if(player) player.nextVideo(); }, 1000);
        }

        function onPlayerReady(event) {
            isReady = true;
            // ì¤€ë¹„ë˜ë©´ ì œëª©ì„ "Ready to Play!"ë¡œ ë³€ê²½
            titleEl.innerText = "Ready to Play! ğŸµ";
            artistEl.innerText = "Click Play Button";
            // ì¬ìƒ ë²„íŠ¼ í™œì„±í™” íš¨ê³¼
            playBtn.style.color = "#E16259"; 
            playBtn.style.transform = "scale(1.1)";
            
            // 1ì´ˆ ë’¤ ì²« ê³¡ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            setTimeout(updateTrackInfo, 1000);
        }

        function onPlayerStateChange(event) {
            // ì¬ìƒ ì¤‘ (1)
            if (event.data == YT.PlayerState.PLAYING) {
                coverContainer.classList.add('rotate');
                // ì•„ì´ì½˜ì„ ì¼ì‹œì •ì§€(||)ë¡œ ë³€ê²½
                playBtn.innerHTML = '<i class="fas fa-pause"></i>'; 
                startProgressLoop();
                updateTrackInfo();
            } 
            // ì¼ì‹œì •ì§€ (2) ë˜ëŠ” ë²„í¼ë§ (3)
            else {
                coverContainer.classList.remove('rotate');
                // ì•„ì´ì½˜ì„ ì¬ìƒ(â–¶)ìœ¼ë¡œ ë³€ê²½
                playBtn.innerHTML = '<i class="fas fa-play"></i>'; 
                stopProgressLoop();
            }
        }

        function updateTrackInfo() {
            if (!player || !player.getVideoData) return;
            const data = player.getVideoData();
            if (data && data.title) {
                titleEl.innerText = data.title;
                artistEl.innerText = data.author;
                const videoId = data.video_id;
                coverEl.src = `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
            }
        }

        // â­ ì¬ìƒ ë²„íŠ¼ ë¡œì§ ìˆ˜ì • (ê°€ì¥ ê°•ë ¥í•˜ê²Œ!)
        playBtn.addEventListener('click', () => {
            if(!isReady || !player) {
                alert("ë¡œë”© ì¤‘ì…ë‹ˆë‹¤! ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");
                return;
            }
            
            const state = player.getPlayerState();
            // ì¬ìƒ ì¤‘(1)ì´ê±°ë‚˜ ë²„í¼ë§(3)ì´ë©´ ë©ˆì¶”ê³ , ì•„ë‹ˆë©´ ì¬ìƒ!
            if (state == 1 || state == 3) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        });

        prevBtn.addEventListener('click', () => player && player.previousVideo());
        nextBtn.addEventListener('click', () => player && player.nextVideo());

        shuffleBtn.addEventListener('click', () => {
            if(!player) return;
            isShuffle = !isShuffle;
            player.setShuffle(isShuffle);
            if(isShuffle) {
                shuffleBtn.classList.add('active');
                // ì…”í”Œ ì ìš©ì„ ìœ„í•´ ë‹¤ìŒ ê³¡ìœ¼ë¡œ ë„˜ê¹€ (ì„ íƒì‚¬í•­)
                // player.nextVideo();
            } else {
                shuffleBtn.classList.remove('active');
            }
        });

        function startProgressLoop() {
            stopProgressLoop();
            updateTimer = setInterval(() => {
                if(!player || !player.getDuration) return;
                const currentTime = player.getCurrentTime();
                const duration = player.getDuration();
                if(duration > 0) {
                    const percent = (currentTime / duration) * 100;
                    progress.style.width = `${percent}%`;
                }
            }, 500);
        }

        function stopProgressLoop() {
            if(updateTimer) clearInterval(updateTimer);
        }

        progressContainer.addEventListener('click', (e) => {
            if(!player) return;
            const width = progressContainer.clientWidth;
            const clickX = e.offsetX;
            const duration = player.getDuration();
            player.seekTo((clickX / width) * duration, true);
        });
    </script>
