<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Calendar</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; }
        .error-box { 
            background: #ffeded; color: #ff0000; border: 1px solid red; 
            padding: 15px; border-radius: 10px; text-align: left; 
            font-size: 0.9rem; white-space: pre-wrap; word-break: break-all;
        }
        .container { display: none; } /* ì—ëŸ¬ ë‚˜ë©´ ë‹¬ë ¥ ìˆ¨ê¹€ */
    </style>
</head>
<body>

    <h3 id="status">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</h3>
    
    <div id="error-area" class="error-box" style="display:none;"></div>

    <div class="container" id="calendar-container">
        <h2>ì„±ê³µ! ğŸ‰</h2>
        <p>ì´ì œ ë‹¤ì‹œ ì›ë˜ ì½”ë“œë¡œ ëŒë ¤ë†”ë„ ë©ë‹ˆë‹¤.</p>
    </div>

    <script>
        async function fetchData() {
            try {
                const res = await fetch('/api/get_tasks');
                const text = await res.text(); // JSONì´ ì•„ë‹ˆë¼ ì—ëŸ¬ HTMLì¼ ìˆ˜ë„ ìˆì–´ì„œ í…ìŠ¤íŠ¸ë¡œ ë¨¼ì € ë°›ìŒ
                
                let data;
                try {
                    data = JSON.parse(text);
                } catch (e) {
                    throw new Error("ì„œë²„ ì‘ë‹µì´ JSONì´ ì•„ë‹™ë‹ˆë‹¤. (500 ì—ëŸ¬ ê°€ëŠ¥ì„±)\n" + text.substring(0, 200) + "...");
                }

                // íŒŒì´ì¬ì—ì„œ ë³´ë‚¸ ì—ëŸ¬ ë©”ì‹œì§€ê°€ ìˆëŠ”ì§€ í™•ì¸
                if (data.error) {
                    throw new Error("API ì—ëŸ¬: " + data.error);
                }

                if (!data.events) {
                    throw new Error("ë°ì´í„° í˜•ì‹ì´ ì´ìƒí•©ë‹ˆë‹¤. (events í‚¤ ì—†ìŒ)");
                }

                // ì„±ê³µ!
                document.getElementById('status').innerText = "";
                document.getElementById('calendar-container').style.display = 'block';

            } catch (err) {
                document.getElementById('status').innerText = "ğŸš¨ ì˜¤ë¥˜ ë°œìƒ!";
                const errBox = document.getElementById('error-area');
                errBox.style.display = 'block';
                errBox.innerText = err.message;
            }
        }

        fetchData();
    </script>
</body>
</html>
